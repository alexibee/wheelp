<h1 class="text-center"> Details of the evaluation request </h1>
<div class="d-flex" data-controller="reveal">
  <div class="p-3">
    <p> Customer: <%= @booking.user.first_name %> </p>
    <p> Vehicle: <%= @booking.vehicle_brand %> </p>
    <p> Vehicle location: <%= @booking.vehicle_address %> </p>
    <p> Owner contact details: <%=@booking.vehicle_contact%> </p>
    <p> Status: <%= render "states_converted", booking: @booking %> </p>
    <% if @booking.state == 0 %>
      <%= link_to "Accept", booking_path(@booking, state: 1), remote: true, method: :patch %>
      <%= link_to "Decline", booking_path(@booking, state: -1), remote: true, method: :patch %>
    <% elsif @booking.state == 1 %>
     <% if !@chatroom.nil? %>
        <%= link_to "Open chat with #{ @booking.user.first_name }","", class: "regular-button", data: { action:"click->reveal#unhideChat" } %>
      <% end %>
      <% if !@booking.evaluation %>
        <%= link_to "Add evaluation", new_booking_evaluation_path(@booking) %>
      <% else @booking.evaluation %>
        <%= link_to "See evaluation", booking_evaluation_path(@booking, @booking.evaluation) %>
      <% end %>
    <% end %>
  </div>
  <div class="showmap" style="width: 80%; height: 400px;"
        data-controller="mbox"
        data-mbox-marker-value="<%= @marker.to_json %>"
        data-mbox-api-key-value="<%= ENV['MAPBOX_API_KEY'] %>">
  </div>
  <div class="container col-3">
    <div class="chatroom-container px-3 d-none" data-controller="chatroom-subscription"
      data-chatroom-subscription-chatroom-id-value="<%= @chatroom.id %>" data-reveal-target="chat">
      <%= link_to "X","", class: "close-chat", data: { action: "click->reveal#hideChat" } %>
      <div class="messages" data-chatroom-subscription-target="messages">
        <% @chatroom.messages.each do |message| %>
          <%= render "messages/message", message: message %>
        <% end %>
      </div>
      <%= simple_form_for [@chatroom, @message],
        remote: true,
        html: {data: {chatroom_subscription_target: "form"}, class: "d-flex align-items-start"} do |f|
      %>
        <%= f.input :content,
        label: false,
        placeholder: "Message ##{@chatroom.name}",
        wrapper_html: {class: "flex-grow-1"}
      %>
        <%= f.submit "Send", class: "regular-button" %>
      <% end %>
    </div>
  </div>
</div>



<%= link_to "Back to your dashboard", dashboard_path %>
